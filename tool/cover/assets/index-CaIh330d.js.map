{"version":3,"file":"index-CaIh330d.js","sources":["../../src/main.ts"],"sourcesContent":["import './style.css'\n\n// ç±»å‹å®šä¹‰\ninterface Ratio {\n  width: number\n  height: number\n  name: string\n}\n\ninterface TextElement {\n  text: string\n  x: number\n  y: number\n  fontSize: number\n  fontFamily: string\n  color: string\n  strokeColor: string\n  strokeWidth: number\n  opacity: number\n}\n\ninterface ImageElement {\n  image: HTMLImageElement\n  x: number\n  y: number\n  width: number\n  height: number\n  scale: number\n  opacity: number\n}\n\ntype TagShape = 'zigzag' | 'rounded' | 'circle' | 'hexagon' | 'ribbon'\n\ninterface TagElement {\n  text: string\n  x: number\n  y: number\n  fontSize: number\n  fontFamily: string\n  textColor: string\n  backgroundColor: string\n  shape: TagShape\n  padding: number\n  opacity: number\n  scale: number\n}\n\ninterface TagTemplate {\n  name: string\n  icon: string\n  defaultText: string\n  shape: TagShape\n  backgroundColor: string\n  textColor: string\n}\n\ninterface DragOffset {\n  x: number\n  y: number\n}\n\ninterface BackgroundState {\n  offsetX: number\n  offsetY: number\n  scale: number\n}\n\ntype EditMode = 'text' | 'background'\ntype SelectedType = 'text' | 'image' | 'tag' | 'none'\n\n// æ¨¡æ¿æ•°æ®ç»“æ„\ninterface SerializedImageElement {\n  imageData: string // BASE64\n  x: number\n  y: number\n  width: number\n  height: number\n  scale: number\n  opacity: number\n}\n\ninterface CoverTemplate {\n  name: string\n  timestamp: number\n  ratio: Ratio\n  backgroundImage: string | null // BASE64\n  backgroundState: BackgroundState\n  textElements: TextElement[]\n  imageElements: SerializedImageElement[]\n  tagElements: TagElement[]\n  settings: {\n    blur: number\n    brightness: number\n  }\n}\n\n// TAG é¢„è®¾æ¨¡æ¿\nconst tagTemplates: TagTemplate[] = [\n  {\n    name: 'å®æˆ˜',\n    icon: 'ğŸ”¥',\n    defaultText: 'å®æˆ˜',\n    shape: 'zigzag',\n    backgroundColor: '#E53E3E',\n    textColor: '#FFFFFF'\n  },\n  {\n    name: 'å­¦ä¹ ',\n    icon: 'ğŸ“š',\n    defaultText: 'å­¦ä¹ ',\n    shape: 'rounded',\n    backgroundColor: '#38A169',\n    textColor: '#FFFFFF'\n  },\n  {\n    name: 'æ–°å“',\n    icon: 'âœ¨',\n    defaultText: 'NEW',\n    shape: 'circle',\n    backgroundColor: '#DD6B20',\n    textColor: '#FFFFFF'\n  },\n  {\n    name: 'çƒ­é—¨',\n    icon: 'ğŸ”¥',\n    defaultText: 'HOT',\n    shape: 'hexagon',\n    backgroundColor: '#D53F8C',\n    textColor: '#FFFFFF'\n  },\n  {\n    name: 'æ¨è',\n    icon: 'ğŸ‘',\n    defaultText: 'æ¨è',\n    shape: 'ribbon',\n    backgroundColor: '#3182CE',\n    textColor: '#FFFFFF'\n  },\n  {\n    name: 'é™æ—¶',\n    icon: 'â°',\n    defaultText: 'é™æ—¶',\n    shape: 'zigzag',\n    backgroundColor: '#805AD5',\n    textColor: '#FFFFFF'\n  }\n]\n\n// å…¨å±€å˜é‡\nlet canvas: HTMLCanvasElement\nlet ctx: CanvasRenderingContext2D\nlet backgroundImage: HTMLImageElement | null = null\nlet currentRatio: Ratio = { width: 1600, height: 1200, name: '4:3' }\nlet textElements: TextElement[] = []\nlet imageElements: ImageElement[] = []\nlet tagElements: TagElement[] = []\nlet selectedTextIndex: number = -1\nlet selectedImageIndex: number = -1\nlet selectedTagIndex: number = -1\nlet selectedType: SelectedType = 'none'\nlet isDragging: boolean = false\nlet dragOffset: DragOffset = { x: 0, y: 0 }\nlet editMode: EditMode = 'text'\nlet backgroundState: BackgroundState = { offsetX: 0, offsetY: 0, scale: 1 }\nlet isDraggingBackground: boolean = false\n\n// æ¨¡æ¿ç®¡ç†\nconst STORAGE_KEY = 'cover_templates'\n\n// åˆå§‹åŒ–\ndocument.addEventListener('DOMContentLoaded', function() {\n  canvas = document.getElementById('canvas') as HTMLCanvasElement\n  const context = canvas.getContext('2d')\n  if (!context) {\n    throw new Error('æ— æ³•è·å– canvas 2d context')\n  }\n  ctx = context\n  \n  initCanvas()\n  setupEventListeners()\n  \n  // æ·»åŠ ä¸€ä¸ªé»˜è®¤æ–‡å­—\n  addTextElement('ä½ çš„æ ‡é¢˜')\n  render()\n})\n\n// åˆå§‹åŒ–ç”»å¸ƒ\nfunction initCanvas(): void {\n  canvas.width = currentRatio.width\n  canvas.height = currentRatio.height\n}\n\n// è·å– DOM å…ƒç´ çš„è¾…åŠ©å‡½æ•°\nfunction getElement<T extends HTMLElement>(id: string): T {\n  const element = document.getElementById(id) as T\n  if (!element) {\n    throw new Error(`Element with id '${id}' not found`)\n  }\n  return element\n}\n\n// è®¾ç½®äº‹ä»¶ç›‘å¬\nfunction setupEventListeners(): void {\n  // å›¾ç‰‡ä¸Šä¼ \n  const uploadArea = getElement<HTMLDivElement>('uploadArea')\n  const imageInput = getElement<HTMLInputElement>('imageInput')\n  \n  uploadArea.addEventListener('click', () => imageInput.click())\n  imageInput.addEventListener('change', handleImageUpload)\n  \n  // æ‹–æ‹½ä¸Šä¼ \n  uploadArea.addEventListener('dragover', (e: DragEvent) => {\n    e.preventDefault()\n    uploadArea.classList.add('dragover')\n  })\n  \n  uploadArea.addEventListener('dragleave', () => {\n    uploadArea.classList.remove('dragover')\n  })\n  \n  uploadArea.addEventListener('drop', (e: DragEvent) => {\n    e.preventDefault()\n    uploadArea.classList.remove('dragover')\n    const file = e.dataTransfer?.files[0]\n    if (file && file.type.startsWith('image/')) {\n      loadImage(file)\n    }\n  })\n  \n  // æ¯”ä¾‹é€‰æ‹©\n  document.querySelectorAll('.ratio-btn').forEach(btn => {\n    btn.addEventListener('click', function(this: HTMLButtonElement) {\n      document.querySelectorAll('.ratio-btn').forEach(b => b.classList.remove('active'))\n      this.classList.add('active')\n      \n      currentRatio = {\n        width: parseInt(this.dataset.width || '1600'),\n        height: parseInt(this.dataset.height || '1200'),\n        name: this.dataset.ratio || '4:3'\n      }\n      \n      canvas.width = currentRatio.width\n      canvas.height = currentRatio.height\n      render()\n    })\n  })\n  \n  // æ–‡å­—è¾“å…¥\n  const textInput = getElement<HTMLInputElement>('textInput')\n  textInput.addEventListener('input', () => {\n    if (selectedTextIndex >= 0 && selectedTextIndex < textElements.length) {\n      textElements[selectedTextIndex].text = textInput.value\n      render()\n    }\n  })\n  \n  // å­—ä½“é€‰æ‹©\n  const fontSelect = getElement<HTMLSelectElement>('fontSelect')\n  fontSelect.addEventListener('change', () => {\n    if (selectedTextIndex >= 0 && selectedTextIndex < textElements.length) {\n      textElements[selectedTextIndex].fontFamily = fontSelect.value\n      render()\n    }\n  })\n  \n  // å­—å·\n  const fontSize = getElement<HTMLInputElement>('fontSize')\n  const fontSizeValue = getElement<HTMLSpanElement>('fontSizeValue')\n  fontSize.addEventListener('input', () => {\n    fontSizeValue.textContent = fontSize.value\n    if (selectedTextIndex >= 0 && selectedTextIndex < textElements.length) {\n      textElements[selectedTextIndex].fontSize = parseInt(fontSize.value)\n      render()\n    }\n  })\n  \n  // æ–‡å­—é¢œè‰²\n  const textColor = getElement<HTMLInputElement>('textColor')\n  textColor.addEventListener('input', () => {\n    if (selectedTextIndex >= 0 && selectedTextIndex < textElements.length) {\n      textElements[selectedTextIndex].color = textColor.value\n      render()\n    }\n  })\n  \n  // æè¾¹é¢œè‰²\n  const strokeColor = getElement<HTMLInputElement>('strokeColor')\n  strokeColor.addEventListener('input', () => {\n    if (selectedTextIndex >= 0 && selectedTextIndex < textElements.length) {\n      textElements[selectedTextIndex].strokeColor = strokeColor.value\n      render()\n    }\n  })\n  \n  // æè¾¹å®½åº¦\n  const strokeWidth = getElement<HTMLInputElement>('strokeWidth')\n  const strokeWidthValue = getElement<HTMLSpanElement>('strokeWidthValue')\n  strokeWidth.addEventListener('input', () => {\n    strokeWidthValue.textContent = strokeWidth.value\n    if (selectedTextIndex >= 0 && selectedTextIndex < textElements.length) {\n      textElements[selectedTextIndex].strokeWidth = parseInt(strokeWidth.value)\n      render()\n    }\n  })\n  \n  // æ–‡å­—ä¸é€æ˜åº¦\n  const textOpacity = getElement<HTMLInputElement>('textOpacity')\n  const textOpacityValue = getElement<HTMLSpanElement>('textOpacityValue')\n  textOpacity.addEventListener('input', () => {\n    textOpacityValue.textContent = textOpacity.value\n    if (selectedTextIndex >= 0 && selectedTextIndex < textElements.length) {\n      textElements[selectedTextIndex].opacity = parseInt(textOpacity.value) / 100\n      render()\n    }\n  })\n  \n  // èƒŒæ™¯æ¨¡ç³Š\n  const bgBlur = getElement<HTMLInputElement>('bgBlur')\n  const blurValue = getElement<HTMLSpanElement>('blurValue')\n  bgBlur.addEventListener('input', () => {\n    blurValue.textContent = bgBlur.value\n    render()\n  })\n  \n  // èƒŒæ™¯äº®åº¦\n  const bgBrightness = getElement<HTMLInputElement>('bgBrightness')\n  const brightnessValue = getElement<HTMLSpanElement>('brightnessValue')\n  bgBrightness.addEventListener('input', () => {\n    brightnessValue.textContent = bgBrightness.value\n    render()\n  })\n  \n  // æ¨¡å¼åˆ‡æ¢\n  const textModeBtn = getElement<HTMLButtonElement>('textModeBtn')\n  const bgModeBtn = getElement<HTMLButtonElement>('bgModeBtn')\n  \n  textModeBtn.addEventListener('click', () => {\n    editMode = 'text'\n    textModeBtn.classList.add('active')\n    bgModeBtn.classList.remove('active')\n    canvas.style.cursor = 'move'\n  })\n  \n  bgModeBtn.addEventListener('click', () => {\n    editMode = 'background'\n    bgModeBtn.classList.add('active')\n    textModeBtn.classList.remove('active')\n    canvas.style.cursor = 'grab'\n  })\n  \n  // èƒŒæ™¯ç¼©æ”¾\n  const bgScale = getElement<HTMLInputElement>('bgScale')\n  const bgScaleValue = getElement<HTMLSpanElement>('bgScaleValue')\n  bgScale.addEventListener('input', () => {\n    bgScaleValue.textContent = bgScale.value\n    backgroundState.scale = parseInt(bgScale.value) / 100\n    render()\n  })\n  \n  // é‡ç½®èƒŒæ™¯ä½ç½®\n  getElement<HTMLButtonElement>('resetBgBtn').addEventListener('click', () => {\n    backgroundState.offsetX = 0\n    backgroundState.offsetY = 0\n    backgroundState.scale = 1\n    bgScale.value = '100'\n    bgScaleValue.textContent = '100'\n    render()\n  })\n  \n  // TAG æ¨¡æ¿æŒ‰é’®\n  document.querySelectorAll('.tag-template-btn').forEach(btn => {\n    btn.addEventListener('click', function(this: HTMLButtonElement) {\n      const templateIndex = parseInt(this.dataset.template || '0')\n      addTagElement(tagTemplates[templateIndex])\n      render()\n    })\n  })\n  \n  // TAG æ–‡å­—è¾“å…¥\n  const tagTextInput = getElement<HTMLInputElement>('tagTextInput')\n  tagTextInput.addEventListener('input', () => {\n    if (selectedTagIndex >= 0 && selectedTagIndex < tagElements.length) {\n      tagElements[selectedTagIndex].text = tagTextInput.value\n      render()\n    }\n  })\n  \n  // TAG å­—ä½“å¤§å°\n  const tagFontSize = getElement<HTMLInputElement>('tagFontSize')\n  const tagFontSizeValue = getElement<HTMLSpanElement>('tagFontSizeValue')\n  tagFontSize.addEventListener('input', () => {\n    tagFontSizeValue.textContent = tagFontSize.value\n    if (selectedTagIndex >= 0 && selectedTagIndex < tagElements.length) {\n      tagElements[selectedTagIndex].fontSize = parseInt(tagFontSize.value)\n      render()\n    }\n  })\n  \n  // TAG ç¼©æ”¾\n  const tagScale = getElement<HTMLInputElement>('tagScale')\n  const tagScaleValue = getElement<HTMLSpanElement>('tagScaleValue')\n  tagScale.addEventListener('input', () => {\n    tagScaleValue.textContent = tagScale.value\n    if (selectedTagIndex >= 0 && selectedTagIndex < tagElements.length) {\n      tagElements[selectedTagIndex].scale = parseInt(tagScale.value) / 100\n      render()\n    }\n  })\n  \n  // TAG ä¸é€æ˜åº¦\n  const tagOpacity = getElement<HTMLInputElement>('tagOpacity')\n  const tagOpacityValue = getElement<HTMLSpanElement>('tagOpacityValue')\n  tagOpacity.addEventListener('input', () => {\n    tagOpacityValue.textContent = tagOpacity.value\n    if (selectedTagIndex >= 0 && selectedTagIndex < tagElements.length) {\n      tagElements[selectedTagIndex].opacity = parseInt(tagOpacity.value) / 100\n      render()\n    }\n  })\n  \n  // åˆ é™¤ TAG æŒ‰é’®\n  getElement<HTMLButtonElement>('removeTagBtn').addEventListener('click', () => {\n    if (selectedTagIndex >= 0 && selectedTagIndex < tagElements.length) {\n      tagElements.splice(selectedTagIndex, 1)\n      selectedTagIndex = -1\n      selectedType = 'none'\n      getElement<HTMLDivElement>('tagEditPanel').style.display = 'none'\n      render()\n    }\n  })\n  \n  // æ·»åŠ å›¾ç‰‡æŒ‰é’®\n  const imageElementInput = getElement<HTMLInputElement>('imageElementInput')\n  getElement<HTMLButtonElement>('addImageBtn').addEventListener('click', () => {\n    imageElementInput.click()\n  })\n  \n  // å›¾ç‰‡ä¸Šä¼ \n  imageElementInput.addEventListener('change', (e) => {\n    const target = e.target as HTMLInputElement\n    const file = target.files?.[0]\n    if (file) {\n      loadImageElement(file)\n      // é‡ç½® input ä»¥ä¾¿å¯ä»¥å†æ¬¡ä¸Šä¼ åŒä¸€ä¸ªæ–‡ä»¶\n      target.value = ''\n    }\n  })\n  \n  // å›¾ç‰‡ç¼©æ”¾\n  const imageScale = getElement<HTMLInputElement>('imageScale')\n  const imageScaleValue = getElement<HTMLSpanElement>('imageScaleValue')\n  imageScale.addEventListener('input', () => {\n    imageScaleValue.textContent = imageScale.value\n    if (selectedImageIndex >= 0 && selectedImageIndex < imageElements.length) {\n      imageElements[selectedImageIndex].scale = parseInt(imageScale.value) / 100\n      render()\n    }\n  })\n  \n  // å›¾ç‰‡ä¸é€æ˜åº¦\n  const imageOpacity = getElement<HTMLInputElement>('imageOpacity')\n  const imageOpacityValue = getElement<HTMLSpanElement>('imageOpacityValue')\n  imageOpacity.addEventListener('input', () => {\n    imageOpacityValue.textContent = imageOpacity.value\n    if (selectedImageIndex >= 0 && selectedImageIndex < imageElements.length) {\n      imageElements[selectedImageIndex].opacity = parseInt(imageOpacity.value) / 100\n      render()\n    }\n  })\n  \n  // åˆ é™¤å›¾ç‰‡æŒ‰é’®\n  getElement<HTMLButtonElement>('removeImageBtn').addEventListener('click', () => {\n    if (selectedImageIndex >= 0 && selectedImageIndex < imageElements.length) {\n      imageElements.splice(selectedImageIndex, 1)\n      selectedImageIndex = -1\n      selectedType = 'none'\n      getElement<HTMLDivElement>('imageControlsPanel').style.display = 'none'\n      render()\n    }\n  })\n  \n  // æ·»åŠ æ–‡å­—æŒ‰é’®\n  getElement<HTMLButtonElement>('addTextBtn').addEventListener('click', () => {\n    const text = getElement<HTMLInputElement>('textInput').value || 'æ–°æ–‡å­—'\n    addTextElement(text)\n    render()\n  })\n  \n  // åˆ é™¤æ–‡å­—æŒ‰é’®\n  getElement<HTMLButtonElement>('removeTextBtn').addEventListener('click', () => {\n    if (selectedTextIndex >= 0 && selectedTextIndex < textElements.length) {\n      textElements.splice(selectedTextIndex, 1)\n      selectedTextIndex = -1\n      render()\n    }\n  })\n  \n  // ä¸‹è½½æŒ‰é’®\n  getElement<HTMLButtonElement>('downloadBtn').addEventListener('click', downloadImage)\n  \n  // æ¨¡æ¿ç®¡ç†æŒ‰é’®\n  getElement<HTMLButtonElement>('saveTemplateBtn').addEventListener('click', () => {\n    exportTemplate()\n  })\n  \n  getElement<HTMLButtonElement>('loadTemplateBtn').addEventListener('click', () => {\n    importTemplateFromFile()\n  })\n  \n  getElement<HTMLButtonElement>('showTemplatesBtn').addEventListener('click', () => {\n    showTemplateModal()\n  })\n  \n  // ç”»å¸ƒé¼ æ ‡äº‹ä»¶\n  canvas.addEventListener('mousedown', handleMouseDown)\n  canvas.addEventListener('mousemove', handleMouseMove)\n  canvas.addEventListener('mouseup', handleMouseUp)\n  canvas.addEventListener('mouseleave', handleMouseUp)\n}\n\n// å¤„ç†å›¾ç‰‡ä¸Šä¼ \nfunction handleImageUpload(e: Event): void {\n  const target = e.target as HTMLInputElement\n  const file = target.files?.[0]\n  if (file) {\n    loadImage(file)\n  }\n}\n\n// åŠ è½½å›¾ç‰‡\nfunction loadImage(file: File): void {\n  const reader = new FileReader()\n  reader.onload = function(e: ProgressEvent<FileReader>) {\n    const img = new Image()\n    img.onload = function() {\n      backgroundImage = img\n      // é‡ç½®èƒŒæ™¯çŠ¶æ€\n      backgroundState.offsetX = 0\n      backgroundState.offsetY = 0\n      backgroundState.scale = 1\n      // é‡ç½®æ§åˆ¶UI\n      getElement<HTMLInputElement>('bgScale').value = '100'\n      getElement<HTMLSpanElement>('bgScaleValue').textContent = '100'\n      render()\n    }\n    img.src = e.target?.result as string\n  }\n  reader.readAsDataURL(file)\n}\n\n// åŠ è½½å›¾ç‰‡å…ƒç´ \nfunction loadImageElement(file: File): void {\n  const reader = new FileReader()\n  reader.onload = function(e: ProgressEvent<FileReader>) {\n    const img = new Image()\n    img.onload = function() {\n      // è®¡ç®—åˆé€‚çš„åˆå§‹å¤§å°ï¼ˆä¸è¶…è¿‡ç”»å¸ƒçš„1/3ï¼‰\n      const maxSize = Math.min(canvas.width, canvas.height) / 3\n      const scale = Math.min(maxSize / img.width, maxSize / img.height, 1)\n      \n      const element: ImageElement = {\n        image: img,\n        x: canvas.width / 2,\n        y: canvas.height / 2,\n        width: img.width,\n        height: img.height,\n        scale: scale,\n        opacity: 1\n      }\n      imageElements.push(element)\n      selectedImageIndex = imageElements.length - 1\n      selectedType = 'image'\n      selectedTextIndex = -1\n      updateImageControlsFromSelected()\n      render()\n    }\n    img.src = e.target?.result as string\n  }\n  reader.readAsDataURL(file)\n}\n\n// æ·»åŠ  TAG å…ƒç´ \nfunction addTagElement(template: TagTemplate): void {\n  const element: TagElement = {\n    text: template.defaultText,\n    x: canvas.width / 2,\n    y: canvas.height / 2,\n    fontSize: 32,\n    fontFamily: \"'PingFang SC', 'Microsoft YaHei', sans-serif\",\n    textColor: template.textColor,\n    backgroundColor: template.backgroundColor,\n    shape: template.shape,\n    padding: 20,\n    opacity: 1,\n    scale: 1\n  }\n  tagElements.push(element)\n  selectedTagIndex = tagElements.length - 1\n  selectedTextIndex = -1\n  selectedImageIndex = -1\n  selectedType = 'tag'\n  getElement<HTMLDivElement>('imageControlsPanel').style.display = 'none'\n  getElement<HTMLDivElement>('tagEditPanel').style.display = 'none'\n  updateTagControlsFromSelected()\n}\n\n// æ·»åŠ æ–‡å­—å…ƒç´ \nfunction addTextElement(text: string): void {\n  const element: TextElement = {\n    text: text,\n    x: canvas.width / 2,\n    y: canvas.height / 2,\n    fontSize: parseInt(getElement<HTMLInputElement>('fontSize').value),\n    fontFamily: getElement<HTMLSelectElement>('fontSelect').value,\n    color: getElement<HTMLInputElement>('textColor').value,\n    strokeColor: getElement<HTMLInputElement>('strokeColor').value,\n    strokeWidth: parseInt(getElement<HTMLInputElement>('strokeWidth').value),\n    opacity: parseInt(getElement<HTMLInputElement>('textOpacity').value) / 100\n  }\n  textElements.push(element)\n  selectedTextIndex = textElements.length - 1\n  selectedImageIndex = -1\n  selectedTagIndex = -1\n  selectedType = 'text'\n  getElement<HTMLDivElement>('imageControlsPanel').style.display = 'none'\n  getElement<HTMLDivElement>('tagEditPanel').style.display = 'none'\n  updateControlsFromSelected()\n}\n\n// æ›´æ–°æ§åˆ¶é¢æ¿æ˜¾ç¤ºé€‰ä¸­çš„æ–‡å­—å±æ€§\nfunction updateControlsFromSelected(): void {\n  if (selectedTextIndex >= 0 && selectedTextIndex < textElements.length) {\n    const element = textElements[selectedTextIndex]\n    getElement<HTMLInputElement>('textInput').value = element.text\n    getElement<HTMLInputElement>('fontSize').value = element.fontSize.toString()\n    getElement<HTMLSpanElement>('fontSizeValue').textContent = element.fontSize.toString()\n    getElement<HTMLSelectElement>('fontSelect').value = element.fontFamily\n    getElement<HTMLInputElement>('textColor').value = element.color\n    getElement<HTMLInputElement>('strokeColor').value = element.strokeColor\n    getElement<HTMLInputElement>('strokeWidth').value = element.strokeWidth.toString()\n    getElement<HTMLSpanElement>('strokeWidthValue').textContent = element.strokeWidth.toString()\n    const opacityPercent = Math.round(element.opacity * 100)\n    getElement<HTMLInputElement>('textOpacity').value = opacityPercent.toString()\n    getElement<HTMLSpanElement>('textOpacityValue').textContent = opacityPercent.toString()\n  }\n}\n\n// æ›´æ–°æ§åˆ¶é¢æ¿æ˜¾ç¤ºé€‰ä¸­çš„å›¾ç‰‡å±æ€§\nfunction updateImageControlsFromSelected(): void {\n  const panel = getElement<HTMLDivElement>('imageControlsPanel')\n  if (selectedImageIndex >= 0 && selectedImageIndex < imageElements.length) {\n    const element = imageElements[selectedImageIndex]\n    panel.style.display = 'block'\n    const scalePercent = Math.round(element.scale * 100)\n    getElement<HTMLInputElement>('imageScale').value = scalePercent.toString()\n    getElement<HTMLSpanElement>('imageScaleValue').textContent = scalePercent.toString()\n    const opacityPercent = Math.round(element.opacity * 100)\n    getElement<HTMLInputElement>('imageOpacity').value = opacityPercent.toString()\n    getElement<HTMLSpanElement>('imageOpacityValue').textContent = opacityPercent.toString()\n  } else {\n    panel.style.display = 'none'\n  }\n}\n\n// æ›´æ–°æ§åˆ¶é¢æ¿æ˜¾ç¤ºé€‰ä¸­çš„ TAG å±æ€§\nfunction updateTagControlsFromSelected(): void {\n  const panel = getElement<HTMLDivElement>('tagEditPanel')\n  if (selectedTagIndex >= 0 && selectedTagIndex < tagElements.length) {\n    const element = tagElements[selectedTagIndex]\n    panel.style.display = 'block'\n    getElement<HTMLInputElement>('tagTextInput').value = element.text\n    getElement<HTMLInputElement>('tagFontSize').value = element.fontSize.toString()\n    getElement<HTMLSpanElement>('tagFontSizeValue').textContent = element.fontSize.toString()\n    const scalePercent = Math.round(element.scale * 100)\n    getElement<HTMLInputElement>('tagScale').value = scalePercent.toString()\n    getElement<HTMLSpanElement>('tagScaleValue').textContent = scalePercent.toString()\n    const opacityPercent = Math.round(element.opacity * 100)\n    getElement<HTMLInputElement>('tagOpacity').value = opacityPercent.toString()\n    getElement<HTMLSpanElement>('tagOpacityValue').textContent = opacityPercent.toString()\n  } else {\n    panel.style.display = 'none'\n  }\n}\n\n// é¼ æ ‡æŒ‰ä¸‹\nfunction handleMouseDown(e: MouseEvent): void {\n  const rect = canvas.getBoundingClientRect()\n  const scaleX = canvas.width / rect.width\n  const scaleY = canvas.height / rect.height\n  const x = (e.clientX - rect.left) * scaleX\n  const y = (e.clientY - rect.top) * scaleY\n  \n  if (editMode === 'background') {\n    // èƒŒæ™¯è°ƒæ•´æ¨¡å¼\n    if (backgroundImage) {\n      isDraggingBackground = true\n      dragOffset.x = x - backgroundState.offsetX\n      dragOffset.y = y - backgroundState.offsetY\n      canvas.style.cursor = 'grabbing'\n    }\n  } else {\n    // æ–‡å­—ç¼–è¾‘æ¨¡å¼ - ä¾æ¬¡æ£€æŸ¥ TAGã€å›¾ç‰‡ã€æ–‡å­—å…ƒç´ ï¼ˆä»åå¾€å‰ï¼Œåæ·»åŠ çš„åœ¨ä¸Šå±‚ï¼‰\n    let hitElement = false\n    \n    // å…ˆæ£€æŸ¥ TAG å…ƒç´ \n    for (let i = tagElements.length - 1; i >= 0; i--) {\n      const element = tagElements[i]\n      const { width, height } = getTagDimensions(element)\n      const halfWidth = width / 2\n      const halfHeight = height / 2\n      \n      if (x >= element.x - halfWidth && x <= element.x + halfWidth &&\n          y >= element.y - halfHeight && y <= element.y + halfHeight) {\n        selectedTagIndex = i\n        selectedTextIndex = -1\n        selectedImageIndex = -1\n        selectedType = 'tag'\n        isDragging = true\n        dragOffset.x = x - element.x\n        dragOffset.y = y - element.y\n        updateTagControlsFromSelected()\n        getElement<HTMLDivElement>('imageControlsPanel').style.display = 'none'\n        render()\n        hitElement = true\n        break\n      }\n    }\n    \n    // å¦‚æœæ²¡æœ‰ç‚¹å‡» TAGï¼Œå†æ£€æŸ¥å›¾ç‰‡å…ƒç´ \n    if (!hitElement) {\n      for (let i = imageElements.length - 1; i >= 0; i--) {\n        const element = imageElements[i]\n        const halfWidth = (element.width * element.scale) / 2\n        const halfHeight = (element.height * element.scale) / 2\n        \n        if (x >= element.x - halfWidth && x <= element.x + halfWidth &&\n            y >= element.y - halfHeight && y <= element.y + halfHeight) {\n          selectedImageIndex = i\n          selectedTextIndex = -1\n          selectedTagIndex = -1\n          selectedType = 'image'\n          isDragging = true\n          dragOffset.x = x - element.x\n          dragOffset.y = y - element.y\n          updateImageControlsFromSelected()\n          getElement<HTMLDivElement>('tagEditPanel').style.display = 'none'\n          render()\n          hitElement = true\n          break\n        }\n      }\n    }\n    \n    // å¦‚æœæ²¡æœ‰ç‚¹å‡»å›¾ç‰‡ï¼Œå†æ£€æŸ¥æ–‡å­—\n    if (!hitElement) {\n      for (let i = textElements.length - 1; i >= 0; i--) {\n        const element = textElements[i]\n        ctx.font = `${element.fontSize}px ${element.fontFamily}`\n        const metrics = ctx.measureText(element.text)\n        const textWidth = metrics.width\n        const textHeight = element.fontSize\n        \n        if (x >= element.x - textWidth / 2 && x <= element.x + textWidth / 2 &&\n            y >= element.y - textHeight / 2 && y <= element.y + textHeight / 2) {\n          selectedTextIndex = i\n          selectedImageIndex = -1\n          selectedTagIndex = -1\n          selectedType = 'text'\n          isDragging = true\n          dragOffset.x = x - element.x\n          dragOffset.y = y - element.y\n          updateControlsFromSelected()\n          getElement<HTMLDivElement>('imageControlsPanel').style.display = 'none'\n          getElement<HTMLDivElement>('tagEditPanel').style.display = 'none'\n          render()\n          hitElement = true\n          break\n        }\n      }\n    }\n  }\n}\n\n// é¼ æ ‡ç§»åŠ¨\nfunction handleMouseMove(e: MouseEvent): void {\n  const rect = canvas.getBoundingClientRect()\n  const scaleX = canvas.width / rect.width\n  const scaleY = canvas.height / rect.height\n  const x = (e.clientX - rect.left) * scaleX\n  const y = (e.clientY - rect.top) * scaleY\n  \n  if (isDraggingBackground) {\n    // æ‹–åŠ¨èƒŒæ™¯\n    backgroundState.offsetX = x - dragOffset.x\n    backgroundState.offsetY = y - dragOffset.y\n    render()\n  } else if (isDragging) {\n    if (selectedType === 'tag' && selectedTagIndex >= 0) {\n      // æ‹–åŠ¨ TAG\n      tagElements[selectedTagIndex].x = x - dragOffset.x\n      tagElements[selectedTagIndex].y = y - dragOffset.y\n      render()\n    } else if (selectedType === 'image' && selectedImageIndex >= 0) {\n      // æ‹–åŠ¨å›¾ç‰‡\n      imageElements[selectedImageIndex].x = x - dragOffset.x\n      imageElements[selectedImageIndex].y = y - dragOffset.y\n      render()\n    } else if (selectedType === 'text' && selectedTextIndex >= 0) {\n      // æ‹–åŠ¨æ–‡å­—\n      textElements[selectedTextIndex].x = x - dragOffset.x\n      textElements[selectedTextIndex].y = y - dragOffset.y\n      render()\n    }\n  }\n}\n\n// é¼ æ ‡é‡Šæ”¾\nfunction handleMouseUp(): void {\n  isDragging = false\n  isDraggingBackground = false\n  if (editMode === 'background' && backgroundImage) {\n    canvas.style.cursor = 'grab'\n  }\n}\n\n// è®¡ç®— TAG å°ºå¯¸\nfunction getTagDimensions(tag: TagElement): { width: number, height: number } {\n  ctx.font = `bold ${tag.fontSize}px ${tag.fontFamily}`\n  const metrics = ctx.measureText(tag.text)\n  const textWidth = metrics.width\n  const textHeight = tag.fontSize\n  \n  const width = (textWidth + tag.padding * 2) * tag.scale\n  const height = (textHeight + tag.padding) * tag.scale\n  \n  return { width, height }\n}\n\n// ç»˜åˆ¶é”¯é½¿å½¢çŠ¶ TAG\nfunction drawZigzagTag(tag: TagElement, x: number, y: number, width: number, height: number): void {\n  ctx.beginPath()\n  const zigzagSize = height * 0.15\n  const numZigzags = Math.floor(width / (zigzagSize * 2))\n  \n  ctx.moveTo(x, y)\n  // ä¸Šè¾¹\n  for (let i = 0; i < numZigzags; i++) {\n    ctx.lineTo(x + (i * 2 + 1) * zigzagSize, y - zigzagSize)\n    ctx.lineTo(x + (i * 2 + 2) * zigzagSize, y)\n  }\n  ctx.lineTo(x + width, y)\n  // å³è¾¹\n  ctx.lineTo(x + width, y + height)\n  // ä¸‹è¾¹\n  for (let i = numZigzags; i > 0; i--) {\n    ctx.lineTo(x + (i * 2) * zigzagSize, y + height + zigzagSize)\n    ctx.lineTo(x + (i * 2 - 1) * zigzagSize, y + height)\n  }\n  ctx.lineTo(x, y + height)\n  // å·¦è¾¹\n  ctx.closePath()\n  \n  ctx.fillStyle = tag.backgroundColor\n  ctx.fill()\n}\n\n// ç»˜åˆ¶åœ†è§’çŸ©å½¢ TAG\nfunction drawRoundedTag(tag: TagElement, x: number, y: number, width: number, height: number): void {\n  const radius = Math.min(height * 0.3, 20)\n  \n  ctx.beginPath()\n  ctx.moveTo(x + radius, y)\n  ctx.lineTo(x + width - radius, y)\n  ctx.arcTo(x + width, y, x + width, y + radius, radius)\n  ctx.lineTo(x + width, y + height - radius)\n  ctx.arcTo(x + width, y + height, x + width - radius, y + height, radius)\n  ctx.lineTo(x + radius, y + height)\n  ctx.arcTo(x, y + height, x, y + height - radius, radius)\n  ctx.lineTo(x, y + radius)\n  ctx.arcTo(x, y, x + radius, y, radius)\n  ctx.closePath()\n  \n  ctx.fillStyle = tag.backgroundColor\n  ctx.fill()\n}\n\n// ç»˜åˆ¶åœ†å½¢ TAG\nfunction drawCircleTag(tag: TagElement, x: number, y: number, width: number, height: number): void {\n  const radius = Math.max(width, height) / 2\n  const centerX = x + width / 2\n  const centerY = y + height / 2\n  \n  ctx.beginPath()\n  ctx.arc(centerX, centerY, radius, 0, Math.PI * 2)\n  ctx.closePath()\n  \n  ctx.fillStyle = tag.backgroundColor\n  ctx.fill()\n}\n\n// ç»˜åˆ¶å…­è¾¹å½¢ TAG\nfunction drawHexagonTag(tag: TagElement, x: number, y: number, width: number, height: number): void {\n  const centerX = x + width / 2\n  const centerY = y + height / 2\n  const radius = Math.max(width, height) / 2\n  \n  ctx.beginPath()\n  for (let i = 0; i < 6; i++) {\n    const angle = (Math.PI / 3) * i - Math.PI / 2\n    const px = centerX + radius * Math.cos(angle)\n    const py = centerY + radius * Math.sin(angle)\n    if (i === 0) {\n      ctx.moveTo(px, py)\n    } else {\n      ctx.lineTo(px, py)\n    }\n  }\n  ctx.closePath()\n  \n  ctx.fillStyle = tag.backgroundColor\n  ctx.fill()\n}\n\n// ç»˜åˆ¶ç¼å¸¦å½¢çŠ¶ TAG\nfunction drawRibbonTag(tag: TagElement, x: number, y: number, width: number, height: number): void {\n  const foldSize = height * 0.3\n  \n  ctx.beginPath()\n  ctx.moveTo(x, y)\n  ctx.lineTo(x + width, y)\n  ctx.lineTo(x + width + foldSize, y + height / 2)\n  ctx.lineTo(x + width, y + height)\n  ctx.lineTo(x, y + height)\n  ctx.lineTo(x - foldSize, y + height / 2)\n  ctx.closePath()\n  \n  ctx.fillStyle = tag.backgroundColor\n  ctx.fill()\n}\n\n// ç»˜åˆ¶ TAG\nfunction drawTag(tag: TagElement, index: number): void {\n  ctx.save()\n  ctx.globalAlpha = tag.opacity\n  \n  const { width, height } = getTagDimensions(tag)\n  const x = tag.x - width / 2\n  const y = tag.y - height / 2\n  \n  // ç»˜åˆ¶å½¢çŠ¶èƒŒæ™¯\n  switch (tag.shape) {\n    case 'zigzag':\n      drawZigzagTag(tag, x, y, width, height)\n      break\n    case 'rounded':\n      drawRoundedTag(tag, x, y, width, height)\n      break\n    case 'circle':\n      drawCircleTag(tag, x, y, width, height)\n      break\n    case 'hexagon':\n      drawHexagonTag(tag, x, y, width, height)\n      break\n    case 'ribbon':\n      drawRibbonTag(tag, x, y, width, height)\n      break\n  }\n  \n  // ç»˜åˆ¶æ–‡å­—\n  ctx.font = `bold ${tag.fontSize * tag.scale}px ${tag.fontFamily}`\n  ctx.fillStyle = tag.textColor\n  ctx.textAlign = 'center'\n  ctx.textBaseline = 'middle'\n  ctx.fillText(tag.text, tag.x, tag.y)\n  \n  // å¦‚æœæ˜¯é€‰ä¸­çš„ TAGï¼Œç»˜åˆ¶è¾¹æ¡†\n  if (index === selectedTagIndex && selectedType === 'tag') {\n    ctx.strokeStyle = '#667eea'\n    ctx.lineWidth = 3\n    ctx.setLineDash([10, 5])\n    ctx.strokeRect(x - 5, y - 5, width + 10, height + 10)\n    ctx.setLineDash([])\n  }\n  \n  ctx.restore()\n}\n\n// æ¸²æŸ“ç”»å¸ƒ\nfunction render(): void {\n  // æ¸…ç©ºç”»å¸ƒ\n  ctx.clearRect(0, 0, canvas.width, canvas.height)\n  \n  // åº”ç”¨æ»¤é•œ\n  const blur = parseInt(getElement<HTMLInputElement>('bgBlur').value)\n  const brightness = parseInt(getElement<HTMLInputElement>('bgBrightness').value)\n  \n  if (blur > 0) {\n    ctx.filter = `blur(${blur}px) brightness(${brightness}%)`\n  } else {\n    ctx.filter = `brightness(${brightness}%)`\n  }\n  \n  // ç»˜åˆ¶èƒŒæ™¯\n  if (backgroundImage) {\n    // è®¡ç®—åŸºç¡€ç¼©æ”¾ï¼ˆå¡«å……ç”»å¸ƒï¼‰\n    const baseScale = Math.max(canvas.width / backgroundImage.width, canvas.height / backgroundImage.height)\n    // åº”ç”¨ç”¨æˆ·è‡ªå®šä¹‰ç¼©æ”¾\n    const finalScale = baseScale * backgroundState.scale\n    \n    // è®¡ç®—å±…ä¸­ä½ç½®\n    const centerX = (canvas.width - backgroundImage.width * finalScale) / 2\n    const centerY = (canvas.height - backgroundImage.height * finalScale) / 2\n    \n    // åº”ç”¨ç”¨æˆ·åç§»\n    const x = centerX + backgroundState.offsetX\n    const y = centerY + backgroundState.offsetY\n    \n    ctx.drawImage(backgroundImage, x, y, backgroundImage.width * finalScale, backgroundImage.height * finalScale)\n  } else {\n    // é»˜è®¤æ¸å˜èƒŒæ™¯\n    const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height)\n    gradient.addColorStop(0, '#667eea')\n    gradient.addColorStop(1, '#764ba2')\n    ctx.fillStyle = gradient\n    ctx.fillRect(0, 0, canvas.width, canvas.height)\n  }\n  \n  // é‡ç½®æ»¤é•œ\n  ctx.filter = 'none'\n  \n  // ç»˜åˆ¶æ‰€æœ‰å›¾ç‰‡å…ƒç´ \n  imageElements.forEach((element, index) => {\n    ctx.save()\n    ctx.globalAlpha = element.opacity\n    \n    const width = element.width * element.scale\n    const height = element.height * element.scale\n    const x = element.x - width / 2\n    const y = element.y - height / 2\n    \n    ctx.drawImage(element.image, x, y, width, height)\n    \n    // å¦‚æœæ˜¯é€‰ä¸­çš„å›¾ç‰‡ï¼Œç»˜åˆ¶è¾¹æ¡†\n    if (index === selectedImageIndex && selectedType === 'image') {\n      ctx.strokeStyle = '#667eea'\n      ctx.lineWidth = 3\n      ctx.setLineDash([10, 5])\n      ctx.strokeRect(x - 5, y - 5, width + 10, height + 10)\n      ctx.setLineDash([])\n    }\n    \n    ctx.restore()\n  })\n  \n  // ç»˜åˆ¶æ‰€æœ‰ TAG å…ƒç´ \n  tagElements.forEach((element, index) => {\n    drawTag(element, index)\n  })\n  \n  // ç»˜åˆ¶æ‰€æœ‰æ–‡å­—\n  textElements.forEach((element, index) => {\n    ctx.save()\n    ctx.globalAlpha = element.opacity\n    ctx.font = `bold ${element.fontSize}px ${element.fontFamily}`\n    ctx.textAlign = 'center'\n    ctx.textBaseline = 'middle'\n    \n    // ç»˜åˆ¶æè¾¹\n    if (element.strokeWidth > 0) {\n      ctx.strokeStyle = element.strokeColor\n      ctx.lineWidth = element.strokeWidth\n      ctx.strokeText(element.text, element.x, element.y)\n    }\n    \n    // ç»˜åˆ¶æ–‡å­—\n    ctx.fillStyle = element.color\n    ctx.fillText(element.text, element.x, element.y)\n    \n    // å¦‚æœæ˜¯é€‰ä¸­çš„æ–‡å­—ï¼Œç»˜åˆ¶è¾¹æ¡†\n    if (index === selectedTextIndex && selectedType === 'text') {\n      const metrics = ctx.measureText(element.text)\n      const textWidth = metrics.width\n      const textHeight = element.fontSize\n      \n      ctx.strokeStyle = '#667eea'\n      ctx.lineWidth = 3\n      ctx.setLineDash([10, 5])\n      ctx.strokeRect(\n        element.x - textWidth / 2 - 10,\n        element.y - textHeight / 2 - 10,\n        textWidth + 20,\n        textHeight + 20\n      )\n      ctx.setLineDash([])\n    }\n    \n    ctx.restore()\n  })\n}\n\n// ä¸‹è½½å›¾ç‰‡\nfunction downloadImage(): void {\n  // ä¸´æ—¶å–æ¶ˆé€‰ä¸­æ•ˆæœ\n  const tempSelectedText = selectedTextIndex\n  const tempSelectedImage = selectedImageIndex\n  const tempSelectedTag = selectedTagIndex\n  const tempSelectedType = selectedType\n  selectedTextIndex = -1\n  selectedImageIndex = -1\n  selectedTagIndex = -1\n  selectedType = 'none'\n  render()\n  \n  // ç”Ÿæˆä¸‹è½½\n  const link = document.createElement('a')\n  link.download = `å°é¢_${currentRatio.name}_${Date.now()}.png`\n  link.href = canvas.toDataURL('image/png')\n  link.click()\n  \n  // æ¢å¤é€‰ä¸­æ•ˆæœ\n  selectedTextIndex = tempSelectedText\n  selectedImageIndex = tempSelectedImage\n  selectedTagIndex = tempSelectedTag\n  selectedType = tempSelectedType\n  render()\n}\n\n// å°†å›¾ç‰‡å…ƒç´ è½¬æ¢ä¸ºå¯åºåˆ—åŒ–æ ¼å¼\nasync function serializeImageElements(): Promise<SerializedImageElement[]> {\n  const serialized: SerializedImageElement[] = []\n  \n  for (const element of imageElements) {\n    // åˆ›å»ºä¸´æ—¶canvasè½¬æ¢å›¾ç‰‡ä¸ºBASE64\n    const tempCanvas = document.createElement('canvas')\n    tempCanvas.width = element.image.width\n    tempCanvas.height = element.image.height\n    const tempCtx = tempCanvas.getContext('2d')\n    if (tempCtx) {\n      tempCtx.drawImage(element.image, 0, 0)\n      const imageData = tempCanvas.toDataURL('image/png')\n      \n      serialized.push({\n        imageData,\n        x: element.x,\n        y: element.y,\n        width: element.width,\n        height: element.height,\n        scale: element.scale,\n        opacity: element.opacity\n      })\n    }\n  }\n  \n  return serialized\n}\n\n// å¯¼å‡ºæ¨¡æ¿\nasync function exportTemplate(): Promise<void> {\n  const templateName = prompt('è¯·è¾“å…¥æ¨¡æ¿åç§°ï¼š', `æ¨¡æ¿_${new Date().toLocaleDateString()}`)\n  if (!templateName) return\n  \n  // è·å–èƒŒæ™¯å›¾BASE64\n  let bgImageData: string | null = null\n  if (backgroundImage) {\n    const tempCanvas = document.createElement('canvas')\n    tempCanvas.width = backgroundImage.width\n    tempCanvas.height = backgroundImage.height\n    const tempCtx = tempCanvas.getContext('2d')\n    if (tempCtx) {\n      tempCtx.drawImage(backgroundImage, 0, 0)\n      bgImageData = tempCanvas.toDataURL('image/png')\n    }\n  }\n  \n  // åºåˆ—åŒ–å›¾ç‰‡å…ƒç´ \n  const serializedImages = await serializeImageElements()\n  \n  // åˆ›å»ºæ¨¡æ¿å¯¹è±¡\n  const template: CoverTemplate = {\n    name: templateName,\n    timestamp: Date.now(),\n    ratio: currentRatio,\n    backgroundImage: bgImageData,\n    backgroundState: { ...backgroundState },\n    textElements: JSON.parse(JSON.stringify(textElements)),\n    imageElements: serializedImages,\n    tagElements: JSON.parse(JSON.stringify(tagElements)),\n    settings: {\n      blur: parseInt(getElement<HTMLInputElement>('bgBlur').value),\n      brightness: parseInt(getElement<HTMLInputElement>('bgBrightness').value)\n    }\n  }\n  \n  // ä¸‹è½½JSONæ–‡ä»¶\n  const blob = new Blob([JSON.stringify(template, null, 2)], { type: 'application/json' })\n  const url = URL.createObjectURL(blob)\n  const link = document.createElement('a')\n  link.href = url\n  link.download = `${templateName}_${Date.now()}.json`\n  link.click()\n  URL.revokeObjectURL(url)\n  \n  // åŒæ—¶ä¿å­˜åˆ°localStorage\n  saveTemplateToStorage(template)\n  \n  alert('æ¨¡æ¿å·²å¯¼å‡ºå¹¶ä¿å­˜åˆ°æœ¬åœ°ï¼')\n}\n\n// ä»BASE64æ¢å¤å›¾ç‰‡å…ƒç´ \nasync function deserializeImageElements(serialized: SerializedImageElement[]): Promise<void> {\n  imageElements = []\n  \n  for (const data of serialized) {\n    const img = new Image()\n    await new Promise<void>((resolve) => {\n      img.onload = () => {\n        imageElements.push({\n          image: img,\n          x: data.x,\n          y: data.y,\n          width: data.width,\n          height: data.height,\n          scale: data.scale,\n          opacity: data.opacity\n        })\n        resolve()\n      }\n      img.src = data.imageData\n    })\n  }\n}\n\n// å¯¼å…¥æ¨¡æ¿\nasync function importTemplate(template: CoverTemplate): Promise<void> {\n  try {\n    // æ¢å¤æ¯”ä¾‹\n    currentRatio = template.ratio\n    canvas.width = currentRatio.width\n    canvas.height = currentRatio.height\n    \n    // æ›´æ–°æ¯”ä¾‹æŒ‰é’®çŠ¶æ€\n    document.querySelectorAll('.ratio-btn').forEach(btn => {\n      btn.classList.remove('active')\n      const btnElement = btn as HTMLButtonElement\n      if (btnElement.dataset.ratio === currentRatio.name) {\n        btn.classList.add('active')\n      }\n    })\n    \n    // æ¢å¤èƒŒæ™¯å›¾\n    if (template.backgroundImage) {\n      const img = new Image()\n      const bgImageSrc = template.backgroundImage\n      await new Promise<void>((resolve) => {\n        img.onload = () => {\n          backgroundImage = img\n          resolve()\n        }\n        img.src = bgImageSrc\n      })\n    } else {\n      backgroundImage = null\n    }\n    \n    // æ¢å¤èƒŒæ™¯çŠ¶æ€\n    backgroundState = { ...template.backgroundState }\n    getElement<HTMLInputElement>('bgScale').value = Math.round(backgroundState.scale * 100).toString()\n    getElement<HTMLSpanElement>('bgScaleValue').textContent = Math.round(backgroundState.scale * 100).toString()\n    \n    // æ¢å¤æ–‡å­—å…ƒç´ \n    textElements = JSON.parse(JSON.stringify(template.textElements))\n    \n    // æ¢å¤å›¾ç‰‡å…ƒç´ \n    await deserializeImageElements(template.imageElements)\n    \n    // æ¢å¤TAGå…ƒç´ \n    tagElements = JSON.parse(JSON.stringify(template.tagElements))\n    \n    // æ¢å¤è®¾ç½®\n    getElement<HTMLInputElement>('bgBlur').value = template.settings.blur.toString()\n    getElement<HTMLSpanElement>('blurValue').textContent = template.settings.blur.toString()\n    getElement<HTMLInputElement>('bgBrightness').value = template.settings.brightness.toString()\n    getElement<HTMLSpanElement>('brightnessValue').textContent = template.settings.brightness.toString()\n    \n    // æ¸…é™¤é€‰ä¸­çŠ¶æ€\n    selectedTextIndex = -1\n    selectedImageIndex = -1\n    selectedTagIndex = -1\n    selectedType = 'none'\n    \n    // é‡æ–°æ¸²æŸ“\n    render()\n    \n    alert('æ¨¡æ¿åŠ è½½æˆåŠŸï¼')\n  } catch (error) {\n    console.error('å¯¼å…¥æ¨¡æ¿å¤±è´¥:', error)\n    alert('æ¨¡æ¿åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®')\n  }\n}\n\n// ä¿å­˜æ¨¡æ¿åˆ°localStorage\nfunction saveTemplateToStorage(template: CoverTemplate): void {\n  try {\n    const templates = loadTemplatesFromStorage()\n    // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨åŒåæ¨¡æ¿\n    const existingIndex = templates.findIndex(t => t.name === template.name)\n    if (existingIndex >= 0) {\n      templates[existingIndex] = template\n    } else {\n      templates.push(template)\n    }\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(templates))\n  } catch (error) {\n    console.error('ä¿å­˜æ¨¡æ¿åˆ°localStorageå¤±è´¥:', error)\n  }\n}\n\n// ä»localStorageåŠ è½½æ¨¡æ¿åˆ—è¡¨\nfunction loadTemplatesFromStorage(): CoverTemplate[] {\n  try {\n    const data = localStorage.getItem(STORAGE_KEY)\n    return data ? JSON.parse(data) : []\n  } catch (error) {\n    console.error('ä»localStorageåŠ è½½æ¨¡æ¿å¤±è´¥:', error)\n    return []\n  }\n}\n\n// ä»æ–‡ä»¶å¯¼å…¥æ¨¡æ¿\nfunction importTemplateFromFile(): void {\n  const input = document.createElement('input')\n  input.type = 'file'\n  input.accept = 'application/json,.json'\n  input.onchange = async (e) => {\n    const file = (e.target as HTMLInputElement).files?.[0]\n    if (file) {\n      try {\n        const text = await file.text()\n        const template = JSON.parse(text) as CoverTemplate\n        await importTemplate(template)\n      } catch (error) {\n        console.error('å¯¼å…¥æ¨¡æ¿å¤±è´¥:', error)\n        alert('æ¨¡æ¿æ–‡ä»¶æ ¼å¼é”™è¯¯')\n      }\n    }\n  }\n  input.click()\n}\n\n// æ˜¾ç¤ºæ¨¡æ¿ç®¡ç†å¼¹çª—\nfunction showTemplateModal(): void {\n  const modal = getElement<HTMLDivElement>('templateModal')\n  const templateList = getElement<HTMLDivElement>('templateList')\n  \n  // åŠ è½½æ¨¡æ¿åˆ—è¡¨\n  const templates = loadTemplatesFromStorage()\n  \n  if (templates.length === 0) {\n    templateList.innerHTML = `\n      <div class=\"template-empty\">\n        <p style=\"font-size: 3em;\">ğŸ“­</p>\n        <p style=\"font-size: 1.1em; color: #666;\">è¿˜æ²¡æœ‰ä¿å­˜ä»»ä½•æ¨¡æ¿</p>\n        <p style=\"font-size: 0.9em; color: #999;\">åˆ¶ä½œå°é¢åç‚¹å‡»\"ğŸ’¾ ä¿å­˜ä¸ºæ¨¡æ¿\"</p>\n      </div>\n    `\n  } else {\n    templateList.innerHTML = templates.map((template, index) => {\n      const date = new Date(template.timestamp).toLocaleString('zh-CN')\n      return `\n        <div class=\"template-item\">\n          <div class=\"template-info\">\n            <div class=\"template-name\">${template.name}</div>\n            <div class=\"template-date\">${date}</div>\n          </div>\n          <div class=\"template-actions\">\n            <button class=\"template-load-btn\" onclick=\"window.loadTemplateFromList(${index})\">\n              åŠ è½½\n            </button>\n            <button class=\"template-delete-btn\" onclick=\"window.deleteTemplateFromList(${index})\">\n              åˆ é™¤\n            </button>\n          </div>\n        </div>\n      `\n    }).join('')\n  }\n  \n  modal.style.display = 'flex'\n}\n\n// ä»åˆ—è¡¨åŠ è½½æ¨¡æ¿\nasync function loadTemplateFromListByIndex(index: number): Promise<void> {\n  const templates = loadTemplatesFromStorage()\n  if (index >= 0 && index < templates.length) {\n    const template = templates[index]\n    await importTemplate(template)\n    getElement<HTMLDivElement>('templateModal').style.display = 'none'\n  }\n}\n\n// ä»åˆ—è¡¨åˆ é™¤æ¨¡æ¿\nfunction deleteTemplateFromListByIndex(index: number): void {\n  if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ¨¡æ¿å—ï¼Ÿ')) {\n    const templates = loadTemplatesFromStorage()\n    templates.splice(index, 1)\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(templates))\n    showTemplateModal() // åˆ·æ–°åˆ—è¡¨\n  }\n}\n\n// æš´éœ²åˆ°windowä»¥ä¾¿HTML onclickè°ƒç”¨\ndeclare global {\n  interface Window {\n    loadTemplateFromList: (index: number) => Promise<void>\n    deleteTemplateFromList: (index: number) => void\n  }\n}\n\nwindow.loadTemplateFromList = loadTemplateFromListByIndex\nwindow.deleteTemplateFromList = deleteTemplateFromListByIndex\n\n"],"names":["tagTemplates","canvas","ctx","backgroundImage","currentRatio","textElements","imageElements","tagElements","selectedTextIndex","selectedImageIndex","selectedTagIndex","selectedType","isDragging","dragOffset","editMode","backgroundState","isDraggingBackground","STORAGE_KEY","context","initCanvas","setupEventListeners","addTextElement","render","getElement","id","element","uploadArea","imageInput","handleImageUpload","e","file","_a","loadImage","btn","b","textInput","fontSelect","fontSize","fontSizeValue","textColor","strokeColor","strokeWidth","strokeWidthValue","textOpacity","textOpacityValue","bgBlur","blurValue","bgBrightness","brightnessValue","textModeBtn","bgModeBtn","bgScale","bgScaleValue","templateIndex","addTagElement","tagTextInput","tagFontSize","tagFontSizeValue","tagScale","tagScaleValue","tagOpacity","tagOpacityValue","imageElementInput","target","loadImageElement","imageScale","imageScaleValue","imageOpacity","imageOpacityValue","text","downloadImage","exportTemplate","importTemplateFromFile","showTemplateModal","handleMouseDown","handleMouseMove","handleMouseUp","reader","img","maxSize","scale","updateImageControlsFromSelected","template","updateTagControlsFromSelected","updateControlsFromSelected","opacityPercent","panel","scalePercent","rect","scaleX","scaleY","x","y","hitElement","i","width","height","getTagDimensions","halfWidth","halfHeight","textWidth","textHeight","tag","drawZigzagTag","zigzagSize","numZigzags","drawRoundedTag","radius","drawCircleTag","centerX","centerY","drawHexagonTag","angle","px","py","drawRibbonTag","foldSize","drawTag","index","blur","brightness","finalScale","gradient","tempSelectedText","tempSelectedImage","tempSelectedTag","tempSelectedType","link","serializeImageElements","serialized","tempCanvas","tempCtx","imageData","templateName","bgImageData","serializedImages","blob","url","saveTemplateToStorage","deserializeImageElements","data","resolve","importTemplate","bgImageSrc","error","templates","loadTemplatesFromStorage","existingIndex","t","input","modal","templateList","date","loadTemplateFromListByIndex","deleteTemplateFromListByIndex"],"mappings":"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"}