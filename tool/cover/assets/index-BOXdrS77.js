(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const f of l.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function e(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(o){if(o.ep)return;o.ep=!0;const l=e(o);fetch(o.href,l)}})();let c,r,S=null,b={width:1600,height:1200,name:"4:3"},g=[],v=[],s=-1,h=-1,y="none",V=!1,m={x:0,y:0},O="text",x={offsetX:0,offsetY:0,scale:1},R=!1;document.addEventListener("DOMContentLoaded",function(){c=document.getElementById("canvas");const n=c.getContext("2d");if(!n)throw new Error("无法获取 canvas 2d context");r=n,j(),J(),U("你的标题"),d()});function j(){c.width=b.width,c.height=b.height}function t(n){const a=document.getElementById(n);if(!a)throw new Error(`Element with id '${n}' not found`);return a}function J(){const n=t("uploadArea"),a=t("imageInput");n.addEventListener("click",()=>a.click()),a.addEventListener("change",Q),n.addEventListener("dragover",L=>{L.preventDefault(),n.classList.add("dragover")}),n.addEventListener("dragleave",()=>{n.classList.remove("dragover")}),n.addEventListener("drop",L=>{var C;L.preventDefault(),n.classList.remove("dragover");const w=(C=L.dataTransfer)==null?void 0:C.files[0];w&&w.type.startsWith("image/")&&$(w)}),document.querySelectorAll(".ratio-btn").forEach(L=>{L.addEventListener("click",function(){document.querySelectorAll(".ratio-btn").forEach(w=>w.classList.remove("active")),this.classList.add("active"),b={width:parseInt(this.dataset.width||"1600"),height:parseInt(this.dataset.height||"1200"),name:this.dataset.ratio||"4:3"},c.width=b.width,c.height=b.height,d()})});const e=t("textInput");e.addEventListener("input",()=>{s>=0&&s<g.length&&(g[s].text=e.value,d())});const i=t("fontSelect");i.addEventListener("change",()=>{s>=0&&s<g.length&&(g[s].fontFamily=i.value,d())});const o=t("fontSize"),l=t("fontSizeValue");o.addEventListener("input",()=>{l.textContent=o.value,s>=0&&s<g.length&&(g[s].fontSize=parseInt(o.value),d())});const f=t("textColor");f.addEventListener("input",()=>{s>=0&&s<g.length&&(g[s].color=f.value,d())});const p=t("strokeColor");p.addEventListener("input",()=>{s>=0&&s<g.length&&(g[s].strokeColor=p.value,d())});const u=t("strokeWidth"),k=t("strokeWidthValue");u.addEventListener("input",()=>{k.textContent=u.value,s>=0&&s<g.length&&(g[s].strokeWidth=parseInt(u.value),d())});const E=t("textOpacity"),I=t("textOpacityValue");E.addEventListener("input",()=>{I.textContent=E.value,s>=0&&s<g.length&&(g[s].opacity=parseInt(E.value)/100,d())});const T=t("bgBlur"),N=t("blurValue");T.addEventListener("input",()=>{N.textContent=T.value,d()});const P=t("bgBrightness"),_=t("brightnessValue");P.addEventListener("input",()=>{_.textContent=P.value,d()});const W=t("textModeBtn"),M=t("bgModeBtn");W.addEventListener("click",()=>{O="text",W.classList.add("active"),M.classList.remove("active"),c.style.cursor="move"}),M.addEventListener("click",()=>{O="background",M.classList.add("active"),W.classList.remove("active"),c.style.cursor="grab"});const B=t("bgScale"),X=t("bgScaleValue");B.addEventListener("input",()=>{X.textContent=B.value,x.scale=parseInt(B.value)/100,d()}),t("resetBgBtn").addEventListener("click",()=>{x.offsetX=0,x.offsetY=0,x.scale=1,B.value="100",X.textContent="100",d()});const Y=t("imageElementInput");t("addImageBtn").addEventListener("click",()=>{Y.click()}),Y.addEventListener("change",L=>{var A;const w=L.target,C=(A=w.files)==null?void 0:A[0];C&&(Z(C),w.value="")});const z=t("imageScale"),G=t("imageScaleValue");z.addEventListener("input",()=>{G.textContent=z.value,h>=0&&h<v.length&&(v[h].scale=parseInt(z.value)/100,d())});const D=t("imageOpacity"),K=t("imageOpacityValue");D.addEventListener("input",()=>{K.textContent=D.value,h>=0&&h<v.length&&(v[h].opacity=parseInt(D.value)/100,d())}),t("removeImageBtn").addEventListener("click",()=>{h>=0&&h<v.length&&(v.splice(h,1),h=-1,y="none",t("imageControlsPanel").style.display="none",d())}),t("addTextBtn").addEventListener("click",()=>{const L=t("textInput").value||"新文字";U(L),d()}),t("removeTextBtn").addEventListener("click",()=>{s>=0&&s<g.length&&(g.splice(s,1),s=-1,d())}),t("downloadBtn").addEventListener("click",nt),c.addEventListener("mousedown",tt),c.addEventListener("mousemove",et),c.addEventListener("mouseup",F),c.addEventListener("mouseleave",F)}function Q(n){var i;const e=(i=n.target.files)==null?void 0:i[0];e&&$(e)}function $(n){const a=new FileReader;a.onload=function(e){var o;const i=new Image;i.onload=function(){S=i,x.offsetX=0,x.offsetY=0,x.scale=1,t("bgScale").value="100",t("bgScaleValue").textContent="100",d()},i.src=(o=e.target)==null?void 0:o.result},a.readAsDataURL(n)}function Z(n){const a=new FileReader;a.onload=function(e){var o;const i=new Image;i.onload=function(){const l=Math.min(c.width,c.height)/3,f=Math.min(l/i.width,l/i.height,1),p={image:i,x:c.width/2,y:c.height/2,width:i.width,height:i.height,scale:f,opacity:1};v.push(p),h=v.length-1,y="image",s=-1,H(),d()},i.src=(o=e.target)==null?void 0:o.result},a.readAsDataURL(n)}function U(n){const a={text:n,x:c.width/2,y:c.height/2,fontSize:parseInt(t("fontSize").value),fontFamily:t("fontSelect").value,color:t("textColor").value,strokeColor:t("strokeColor").value,strokeWidth:parseInt(t("strokeWidth").value),opacity:parseInt(t("textOpacity").value)/100};g.push(a),s=g.length-1,h=-1,y="text",t("imageControlsPanel").style.display="none",q()}function q(){if(s>=0&&s<g.length){const n=g[s];t("textInput").value=n.text,t("fontSize").value=n.fontSize.toString(),t("fontSizeValue").textContent=n.fontSize.toString(),t("fontSelect").value=n.fontFamily,t("textColor").value=n.color,t("strokeColor").value=n.strokeColor,t("strokeWidth").value=n.strokeWidth.toString(),t("strokeWidthValue").textContent=n.strokeWidth.toString();const a=Math.round(n.opacity*100);t("textOpacity").value=a.toString(),t("textOpacityValue").textContent=a.toString()}}function H(){const n=t("imageControlsPanel");if(h>=0&&h<v.length){const a=v[h];n.style.display="block";const e=Math.round(a.scale*100);t("imageScale").value=e.toString(),t("imageScaleValue").textContent=e.toString();const i=Math.round(a.opacity*100);t("imageOpacity").value=i.toString(),t("imageOpacityValue").textContent=i.toString()}else n.style.display="none"}function tt(n){const a=c.getBoundingClientRect(),e=c.width/a.width,i=c.height/a.height,o=(n.clientX-a.left)*e,l=(n.clientY-a.top)*i;if(O==="background")S&&(R=!0,m.x=o-x.offsetX,m.y=l-x.offsetY,c.style.cursor="grabbing");else{let f=!1;for(let p=v.length-1;p>=0;p--){const u=v[p],k=u.width*u.scale/2,E=u.height*u.scale/2;if(o>=u.x-k&&o<=u.x+k&&l>=u.y-E&&l<=u.y+E){h=p,s=-1,y="image",V=!0,m.x=o-u.x,m.y=l-u.y,H(),d(),f=!0;break}}if(!f)for(let p=g.length-1;p>=0;p--){const u=g[p];r.font=`${u.fontSize}px ${u.fontFamily}`;const E=r.measureText(u.text).width,I=u.fontSize;if(o>=u.x-E/2&&o<=u.x+E/2&&l>=u.y-I/2&&l<=u.y+I/2){s=p,h=-1,y="text",V=!0,m.x=o-u.x,m.y=l-u.y,q(),t("imageControlsPanel").style.display="none",d(),f=!0;break}}}}function et(n){const a=c.getBoundingClientRect(),e=c.width/a.width,i=c.height/a.height,o=(n.clientX-a.left)*e,l=(n.clientY-a.top)*i;R?(x.offsetX=o-m.x,x.offsetY=l-m.y,d()):V&&(y==="image"&&h>=0?(v[h].x=o-m.x,v[h].y=l-m.y,d()):y==="text"&&s>=0&&(g[s].x=o-m.x,g[s].y=l-m.y,d()))}function F(){V=!1,R=!1,O==="background"&&S&&(c.style.cursor="grab")}function d(){r.clearRect(0,0,c.width,c.height);const n=parseInt(t("bgBlur").value),a=parseInt(t("bgBrightness").value);if(n>0?r.filter=`blur(${n}px) brightness(${a}%)`:r.filter=`brightness(${a}%)`,S){const i=Math.max(c.width/S.width,c.height/S.height)*x.scale,o=(c.width-S.width*i)/2,l=(c.height-S.height*i)/2,f=o+x.offsetX,p=l+x.offsetY;r.drawImage(S,f,p,S.width*i,S.height*i)}else{const e=r.createLinearGradient(0,0,c.width,c.height);e.addColorStop(0,"#667eea"),e.addColorStop(1,"#764ba2"),r.fillStyle=e,r.fillRect(0,0,c.width,c.height)}r.filter="none",v.forEach((e,i)=>{r.save(),r.globalAlpha=e.opacity;const o=e.width*e.scale,l=e.height*e.scale,f=e.x-o/2,p=e.y-l/2;r.drawImage(e.image,f,p,o,l),i===h&&y==="image"&&(r.strokeStyle="#667eea",r.lineWidth=3,r.setLineDash([10,5]),r.strokeRect(f-5,p-5,o+10,l+10),r.setLineDash([])),r.restore()}),g.forEach((e,i)=>{if(r.save(),r.globalAlpha=e.opacity,r.font=`bold ${e.fontSize}px ${e.fontFamily}`,r.textAlign="center",r.textBaseline="middle",e.strokeWidth>0&&(r.strokeStyle=e.strokeColor,r.lineWidth=e.strokeWidth,r.strokeText(e.text,e.x,e.y)),r.fillStyle=e.color,r.fillText(e.text,e.x,e.y),i===s&&y==="text"){const l=r.measureText(e.text).width,f=e.fontSize;r.strokeStyle="#667eea",r.lineWidth=3,r.setLineDash([10,5]),r.strokeRect(e.x-l/2-10,e.y-f/2-10,l+20,f+20),r.setLineDash([])}r.restore()})}function nt(){const n=s,a=h,e=y;s=-1,h=-1,y="none",d();const i=document.createElement("a");i.download=`封面_${b.name}_${Date.now()}.png`,i.href=c.toDataURL("image/png"),i.click(),s=n,h=a,y=e,d()}
//# sourceMappingURL=index-BOXdrS77.js.map
